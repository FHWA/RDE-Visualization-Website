/*!
 * dc-addons v0.13.1
 *
 * 2016-07-20 11:39:52
 *
 */
!function(){"use strict";return!dc.baseMapChart&&void(dc.baseMapChart=function(a){a=dc.baseChart(a);var b,c=!0,d=!1,e=!1,f=!1,g=!1,h=function(a){L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}).addTo(a)},i=function(b){return a.title()(b)};return a._doRender=function(){},a._postRender=function(){},a.toLocArray=function(){},a.mapOptions=function(b){return arguments.length?(d=b,a):d},a.center=function(b){return arguments.length?(e=b,a):e},a.zoom=function(b){return arguments.length?(f=b,a):f},a.tiles=function(b){return arguments.length?(h=b,a):h},a.map=function(a){return arguments.length?b=a:b},a.popup=function(b){return arguments.length?(i=b,a):i},a.renderPopup=function(b){return arguments.length?(c=b,a):c},a.brushOn=function(b){return arguments.length?(g=b,a):g},a})}(),function(){"use strict";return!dc.baseLeafletChart&&void(dc.baseLeafletChart=function(a){return a=dc.baseMapChart(a),a._doRender=function(){var b=L.map(a.root().node(),a.mapOptions());return a.center()&&a.zoom()&&b.setView(a.toLocArray(a.center()),a.zoom()),a.tiles()(b),a.map(b),a._postRender(),a._doRedraw()},a.toLocArray=function(a){
// else expects [11.111,1.111]
// expects '11.111,1.111'
return"string"==typeof a&&(a=a.split(",")),a},a})}(),function(){"use strict";return!dc.leafletChoroplethChart&&void(dc.leafletChoroplethChart=function(a,b){var c=dc.colorChart(dc.baseLeafletChart({})),d=!1,e=[],f=!1,g={fillColor:"black",color:"gray",opacity:.4,fillOpacity:.6,weight:1},h=function(a){return a.key},i=function(a){var b=c.featureOptions();b instanceof Function&&(b=b(a)),b=JSON.parse(JSON.stringify(b));var d=e[c.featureKeyAccessor()(a)];return d&&d.d&&(b.fillColor=c.getColor(d.d,d.i),c.filters().indexOf(d.d.key)!==-1&&(b.opacity=.8,b.fillOpacity=1)),b};c._postRender=function(){d=L.geoJson(c.geojson(),{style:c.featureStyle(),onEachFeature:j}),c.map().addLayer(d)},c._doRedraw=function(){d.clearLayers(),e=[],c._computeOrderedGroups(c.data()).forEach(function(a,b){e[c.keyAccessor()(a)]={d:a,i:b}}),d.addData(c.geojson())},c.geojson=function(a){return arguments.length?(f=a,c):f},c.featureOptions=function(a){return arguments.length?(g=a,c):g},c.featureKeyAccessor=function(a){return arguments.length?(h=a,c):h},c.featureStyle=function(a){return arguments.length?(i=a,c):i};var j=function(a,b){var d=e[c.featureKeyAccessor()(a)];d&&d.d&&(b.key=d.d.key,c.renderPopup()&&b.bindPopup(c.popup()(d.d,a)),c.brushOn()&&b.on("click",k))},k=function(a){if(a.target){var b=a.target.key;dc.events.trigger(function(){c.filter(b),dc.redrawAll(c.chartGroup())})}};return c.anchor(a,b)})}(),function(){"use strict";return!dc.leafletMarkerChart&&void(dc.leafletMarkerChart=function(a,b){var c=dc.baseLeafletChart({}),d=!1,e=!1,f=!1,g=!0,h=!1,i=!1,j=!1,k=!1,l={},m=!0,n=!1,o=!1,p=!0,q=!1;c.renderTitle(!0);var r=function(a){return c.keyAccessor()(a)},s=function(a){var b=new L.Marker(c.toLocArray(c.locationAccessor()(a)),{title:c.renderTitle()?c.title()(a):"",alt:c.renderTitle()?c.title()(a):"",icon:t(a,c.map()),clickable:c.renderPopup()||c.brushOn()&&!h,draggable:!1});return b},t=function(a,b){return new L.Icon.Default},u=function(a,b){return c.title()(a)};c._postRender=function(){c.brushOn()&&(h&&c.filterHandler(y),c.map().on("zoomend moveend",x,this),h||c.map().on("click",x,this),c.map().on("zoomstart",w,this)),k=d?new L.MarkerClusterGroup(e?e:null):new L.LayerGroup,c.map().addLayer(k)},c._doRedraw=function(){var a=c._computeOrderedGroups(c.data()).filter(function(a){return 0!==c.valueAccessor()(a)});f&&(l={}),k.clearLayers();var b=[];if(a.forEach(function(a,d){var e=c.keyAccessor()(a),g=null;g=!f&&e in l?l[e]:v(a,e);var h=c.filters(),i=h.length?.3:1;h.forEach(function(a){e===a&&(i=1)}),g.setOpacity(i),c.cluster()?b.push(g):k.addLayer(g)}),c.cluster()&&b.length>0&&k.addLayers(b),b.length>0&&(m||n&&!o)){var d=new L.featureGroup(b);c.map().fitBounds(d.getBounds())}o=!1,m=!1},c.locationAccessor=function(a){return arguments.length?(r=a,c):r},c.marker=function(a){return arguments.length?(s=a,c):s},c.icon=function(a){return arguments.length?(t=a,c):t},c.popup=function(a){return arguments.length?(u=a,c):u},c.renderPopup=function(a){return arguments.length?(p=a,c):p},c.popupOnHover=function(a){return arguments.length?(q=a,c):q},c.cluster=function(a){return arguments.length?(d=a,c):d},c.clusterOptions=function(a){return arguments.length?(e=a,c):e},c.rebuildMarkers=function(a){return arguments.length?(f=a,c):f},c.brushOn=function(a){return arguments.length?(g=a,c):g},c.filterByArea=function(a){return arguments.length?(h=a,c):h},c.fitOnRender=function(a){return arguments.length?(m=a,c):m},c.fitOnRedraw=function(a){return arguments.length?(n=a,c):n},c.markerGroup=function(){return k};var v=function(a,b){var d=s(a);return d.key=b,c.renderPopup()&&(d.bindPopup(c.popup()(a,d)),c.popupOnHover()&&(d.on("mouseover",function(){d.openPopup()}),d.on("mouseout",function(){d.closePopup()}))),c.brushOn()&&!h&&d.on("click",A),l[b]=d,d},w=function(a){j=!0},x=function(a){if("moveend"!==a.type||!j&&!a.hard)if(j=!1,o=!0,h){var b;b=c.map().getCenter().equals(c.center())&&c.map().getZoom()===c.zoom()?null:c.map().getBounds(),dc.events.trigger(function(){c.filter(null),b&&(i=!0,c.filter(b),i=!1),dc.redrawAll(c.chartGroup())})}else c.filter()&&("click"===a.type||l.hasOwnProperty(c.filter())&&!c.map().getBounds().contains(l[c.filter()].getLatLng()))&&dc.events.trigger(function(){c.filter(null),p&&c.map().closePopup(),dc.redrawAll(c.chartGroup())})},y=function(a,b){o=!0,c.dimension().filter(null),b&&b.length>0&&(c.dimension().filterFunction(function(a){if(!(a in l))return!1;var c=l[a].getLatLng();return c&&b[0].contains(c)}),i||c.map().getBounds().toString===b[0].toString()||c.map().fitBounds(b[0]))};dc.override(c,"filter",function(a){return arguments.length?(z(a),void c._filter(a)):c._filter()});var z=function(a){if(null===a)Object.keys(l).forEach(function(a){l[a].setOpacity(1)});else if(c.filters().length){var b=!1;c.filters().forEach(function(c){c===a&&(b=!0)}),l[a].setOpacity(b?.3:1)}else Object.keys(l).forEach(function(b){b!==a&&l[b].setOpacity(.3)})},A=function(a){if(a.target){o=!0;var b=a.target.key;dc.events.trigger(function(){c.filter(b),dc.redrawAll(c.chartGroup())})}};return c.anchor(a,b)})}(),function(){"use strict";return!dc.leafletCustomChart&&void(dc.leafletCustomChart=function(a,b){var c=dc.baseLeafletChart({}),d=null,e=null;return c.renderTitle(!0),c._postRender=function(){var a=c._computeOrderedGroups(c.data());a.forEach(function(a,b){c.renderItem()(c,c.map(),a,b)})},c._doRedraw=function(){var a=c._computeOrderedGroups(c.data()),b=c.valueAccessor();a.forEach(function(a,d){a.filtered=0===b(a),c.redrawItem()(c,c.map(),a,d)})},c.redrawItem=function(a){return arguments.length?(d=a,c):d},c.renderItem=function(a){return arguments.length?(e=a,c):e},c.anchor(a,b)})}(),
//Legend code adapted from http://leafletjs.com/examples/choropleth.html
dc.leafletLegend=function(){var a,b={},c=null,d="bottomleft";b.parent=function(b){return arguments.length?(a=b,this):a};var e=function(){return L.Control.extend({options:{position:d},onAdd:function(a){return this._div=L.DomUtil.create("div","info legend"),a.on("moveend",this._update,this),this._update(),this._div},_update:function(){if(a.colorDomain()){// check because undefined for marker charts
var b,c=a.colorDomain()[0],d=a.colorDomain()[1],e=a.colors().range(),f=a.colors().range().length,g=(d-c)/f,h=[];for(h[0]=Math.round(c),b=1;b<f;b++)h[b]=Math.round((.5+(b-1))*g+c);//reset so that legend is not plotted multiple times
for(
// var div = L.DomUtil.create('div', 'info legend');
// loop through our density intervals and generate a label with a colored
// square for each interval
this._div.innerHTML="",b=0;b<h.length;b++)this._div.innerHTML+='<i style="background:'+e[b]+'"></i> '+h[b]+(h[b+1]?"&ndash;"+h[b+1]+"<br>":"+")}}})};return b.LegendClass=function(a){return arguments.length?(e=a,b):e},b.render=function(){
// unfortunately the dc.js legend has no concept of redraw, it's always render
if(!c){
// fetch the legend class creator, invoke it
var d=b.LegendClass()();
// and constuct that class
c=new d,c.addTo(a.map())}return b.redraw()},b.redraw=function(){return c._update(),b},b.leafletLegend=function(){return c},b.position=function(a){return arguments.length?(d=a,b):d},b};